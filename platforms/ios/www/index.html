<div style="margin: 20px 20px 20px 2px">
  <button onclick="recordVideo()">REC</button>
  <button onclick="stopRecordVideo()">STOP</button>
  <button onclick="download()">Download</button>
  <button onclick="playVideo()">Play</button>
  <button onclick="pauseVideo()">Pause</button>


  <div>
    <video  id="live-video" muted="muted" autoplay controls></video>
  </div>

  <div>
    <video id="stream" autoplay controls></video>
  </div>
<div>

<script src="recordrtc.js"></script>
<script src="cordova.js"></script>
<script src="ios-websocket-hack.min.js"></script>
<script type="text/javascript">

function captureCamera(callback) {

  if(cordova.plugins.iosrtc)
    cordova.plugins.iosrtc.registerGlobals();

  navigator.mediaDevices.getUserMedia({ audio: true, video: true })
  .then(function(camera) {
    callback(camera);
  }).catch(function(error) {
    console.log(error);
  });
}

var liveVideo = document.getElementById('live-video');
var videoStream = document.getElementById("stream");


function recordVideo() {
  captureCamera(function(camera) {
    liveVideo.muted = true;
    liveVideo.volume = 0;
    liveVideo.srcObject = camera;
    recordRTC = RecordRTC(camera, {
      type: 'video',
      mimeType: 'video/mp4'
    });
    recordRTC.startRecording();
    recordRTC.camera = camera;
  });
};

function stopRecordingCallback() {
  videoStream.muted = false;
  videoStream.volume = 1;
  videoStream.src = URL.createObjectURL(recordRTC.getBlob());
  recordRTC.camera.getVideoTracks()[0].stop();
}

function stopRecordVideo() {
  recordRTC.stopRecording(stopRecordingCallback);
}

function download() {
  invokeSaveAsDialog(recordRTC.getBlob(),'recording_h264.webm');
}

function playVideo() {
  videoStream.play();
}

function pauseVideo() {
  videoStream.pause();
}

</script>
